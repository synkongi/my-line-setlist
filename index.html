<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SINK : MY LINE – Setlist Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f2f3f7;
      color: #222;
    }
    button {
      cursor: pointer;
      border: none;
      background: none;
      font-family: inherit;
    }
    .app { max-width: 900px; margin: 0 auto 40px; }

    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .controls button {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccd0dd;
      background: #fff;
      font-size: 13px;
    }
    .controls button:hover { background: #eef1f8; }
    .controls .spacer { flex: 1; }

    .poster {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
    }

    .poster-header {
      padding: 28px 32px 20px;
      background: linear-gradient(
        90deg,
        #8a63ff 0%,
        #b97dff 22%,
        #a2e6ff 55%,
        #b8f1ff 100%
      );
      color: #fff;
      position: relative;
    }
    .header-left-title-top {
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .header-left-title-bottom {
      font-size: 28px;
      font-weight: 700;
      margin-top: 6px;
    }
    .header-layout {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
    }
    .header-right {
      text-align: right;
      font-size: 16px;
      font-weight: 600;
    }
    .header-right .producer-label {
      text-transform: lowercase;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .producer-name-wrapper {
      display: inline-flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 13px;
    }
 .producer-input {
  border: none;
  border-bottom: 1px solid rgba(255,255,255,0.8);
  background: transparent;
  color: #fff;
  padding: 2px 0;
  min-width: 140px;
  font-size: 14px;
  text-align: right;
  outline: none;

  /* PC · 모바일 공통: 얇은 그림자 */
  text-shadow: 0 0 2px rgba(0, 0, 0, 0.25);
}

    .producer-input::placeholder { color: rgba(255,255,255,0.6); }

    .table-wrapper { padding: 0 24px 32px; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    thead th {
      background: #e0e2ed;
      color: #555;
      padding: 8px 10px;
      border-bottom: 1px solid #c0c4d4;
      text-align: center;
      font-weight: 600;
    }
    tbody td { border-bottom: 1px solid #f0f1f6; }

    .order-cell {
      width: 52px;
      text-align: center;
      color: #666;
      font-variant-numeric: tabular-nums;
    }

    .song-title-cell { padding: 0; }
    .song-cell-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 6px 10px;
    }
    .song-cell-btn {
      flex: 1;
      padding: 8px 10px;
      text-align: center;
      font-size: 13px;
      border-radius: 4px;
      background: #fff;
      color: #333;
      border: none;
    }
    .song-cell-btn:hover { background: #f4f6fc; }
    .song-cell-btn.empty { color: #c0c4d4; }
    .song-row:nth-child(even) .song-cell-btn { background: #fafbff; }

    .song-delete-btn {
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 4px;
      border: 1px solid #e0e2f0;
      background: #f7f8fd;
      color: #666;
      flex-shrink: 0;
    }
    .song-delete-btn:hover { background: #e7e9f5; }

    .ment-row { background: #f3f4f9; }
    .ment-row.dragging { opacity: 0.6; }
    .ment-cell {
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 12px;
      color: #666;
    }
    .ment-label {
      font-weight: 600;
      letter-spacing: 0.04em;
    }
    .ment-handle {
      font-size: 16px;
      cursor: grab;
      user-select: none;
      padding: 2px 4px;
    }
    .ment-row.dragging .ment-handle { cursor: grabbing; }
    .ment-delete-btn {
      padding: 3px 8px;
      font-size: 11px;
      border-radius: 4px;
      background: #dde2f2;
      color: #445;
    }
    .ment-delete-btn:hover { background: #c8cfea; }

    .credit {
      padding: 6px 16px 10px;
      font-size: 11px;
      text-align: right;
      color: #888;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: #fff;
      border-radius: 12px;
      width: min(520px, 100% - 32px);
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 16px 40px rgba(0,0,0,0.3);
    }
    .modal-header {
      padding: 12px 16px 10px;
      border-bottom: 1px solid #eceff6;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .modal-title { font-size: 14px; font-weight: 600; }
    .page-nav {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
    }
    .page-nav button {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid #ccd0dd;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
    }
    .page-nav button:disabled { opacity: 0.4; cursor: default; }
    .page-indicator { min-width: 56px; text-align: center; }
    .modal-close {
      font-size: 18px;
      line-height: 1;
      padding: 2px 4px;
      color: #999;
    }

    .modal-body {
      padding: 12px 16px 14px;
      overflow-y: auto;
    }
    .album-header {
      display: flex;
      gap: 12px;
      margin-bottom: 10px;
      align-items: center;
    }
    .album-cover {
      width: 84px;
      height: 84px;
      border-radius: 8px;
      object-fit: cover;
      background: #ddd;
      flex-shrink: 0;
    }
    .album-meta-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .album-meta-sub {
      font-size: 12px;
      color: #777;
    }

    .track-list {
      list-style: none;
      padding: 0;
      margin: 8px 0 0;
    }
    .track-list li + li { border-top: 1px solid #f0f1f6; }
    .track-btn {
      width: 100%;
      padding: 9px 4px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
    }
    .track-cover {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      object-fit: cover;
      background: #ddd;
      flex-shrink: 0;
    }
    .track-text-main { font-weight: 500; }
    .track-text-sub {
      font-size: 11px;
      color: #888;
      margin-top: 2px;
    }
    .track-meta {
      display: flex;
      flex-direction: column;
    }
    .track-btn:hover { background: #f7f8fd; }
    .track-btn.direct-input {
      justify-content: center;
      font-weight: 600;
      color: #444;
    }

    @media (max-width: 640px) {
      .header-left-title-top { font-size: 24px; }
      .header-left-title-bottom { font-size: 20px; }
      .poster-header { padding: 20px 18px 14px; }
      .table-wrapper { padding: 0 14px 20px; }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="controls">
    <button id="addMentBtn" type="button">+ 멘트/VCR 행 추가</button>
    <button id="addSongBtn" type="button">+ 곡 추가</button>
    <div class="spacer"></div>
    <button id="exportBtn" type="button">이미지 저장</button>
  </div>

  <div id="poster" class="poster">
    <div class="poster-header">
      <div class="header-layout">
        <div>
          <div class="header-left-title-top">SINK : MY LINE</div>
          <div class="header-left-title-bottom">MY's Dream Concert</div>
        </div>
        <div class="header-right">
          <div class="producer-label">producer</div>
          <div class="producer-name-wrapper">
            <input id="producerName" class="producer-input" placeholder="your name" />
          </div>
        </div>
      </div>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
        <tr>
          <th style="width:52px;">순서</th>
          <th>곡명</th>
        </tr>
        </thead>
        <tbody id="setlistBody"></tbody>
      </table>
    </div>

    <div class="credit">cr. synkongi</div>
  </div>
</div>

<div id="songModal" class="modal-overlay">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title">곡 선택</div>
      <div class="page-nav">
        <button id="prevPageBtn" type="button">&lt;</button>
        <span id="pageIndicator" class="page-indicator">1 / 1</span>
        <button id="nextPageBtn" type="button">&gt;</button>
      </div>
      <button id="closeModalBtn" class="modal-close" type="button">&times;</button>
    </div>
    <div class="modal-body">
      <div class="album-header">
        <img id="albumCover" class="album-cover" alt="album cover" />
        <div>
          <div id="albumTitle" class="album-meta-title">Album Title</div>
          <div id="albumSub" class="album-meta-sub">AESPA</div>
        </div>
      </div>
      <ul id="trackList" class="track-list"></ul>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  const isTouch = ("ontouchstart" in window) || (navigator.maxTouchPoints > 0);

 const albumPages = [
  // 1. Black Mamba
  {
    id: 'black-mamba',
    title: 'Black Mamba',
    sub: 'Single Album',
    cover: 'black-mamba.jpg',
    tracks: [
      { id: 'black-mamba-track', title: 'Black Mamba' }
    ]
  },

  // 2. Next Level
  {
    id: 'next-level',
    title: 'Next Level',
    sub: 'Single Album',
    cover: 'next-level.jpg',
    tracks: [
      { id: 'next-level-track', title: 'Next Level' }
    ]
  },

  // 3. Savage - The 1st Mini Album
  {
    id: 'savage',
    title: 'Savage - The 1st Mini Album',
    sub: 'EP',
    cover: 'savage.jpg',
    tracks: [
      { id: 'aenergy', title: 'aenergy' },
      { id: 'savage-title', title: 'Savage', sub: '[TITLE]' },
      { id: 'ill-make-you-cry', title: 'I’ll Make You Cry' },
      { id: 'yeppi-yeppi', title: 'YEPPI YEPPI' },
      { id: 'iconic', title: 'ICONIC' },
      { id: 'lucid-dream', title: '자각몽 (Lucid Dream)' }
    ]
  },

  // 4. Girls - The 2nd Mini Album
  {
    id: 'girls',
    title: 'Girls - The 2nd Mini Album',
    sub: 'EP',
    cover: 'girls.jpg',
    tracks: [
      { id: 'girls-title', title: 'Girls', sub: '[TITLE]' },
      { id: 'illusion', title: '도깨비불 (Illusion)' },
      { id: 'lingo', title: 'Lingo' },
      { id: 'lts-kor', title: 'Life′s Too Short' },
      { id: 'icu', title: 'ICU (쉬어가도 돼)' },
      { id: 'lts-eng', title: 'Life′s Too Short (English Ver.)' },
      { id: 'forever', title: 'Forever (약속)' },
      { id: 'dreams-come-true', title: 'Dreams Come True' }
    ]
  },

  // 5. MY WORLD - The 3rd Mini Album
  {
    id: 'my-world',
    title: 'MY WORLD - The 3rd Mini Album',
    sub: 'EP',
    cover: 'my-world.jpg',
    tracks: [
      { id: 'welcome', title: 'Welcome To MY World (Feat. nævis)' },
      { id: 'spicy-title', title: 'Spicy', sub: '[TITLE]' },
      { id: 'salty-sweet', title: 'Salty & Sweet' },
      { id: 'thirsty', title: 'Thirsty' },
      { id: 'im-unhappy', title: 'I\'m Unhappy' },
      { id: 'til-we-meet-again', title: '\'Til We Meet Again' }
    ]
  },

  // 6. Better Things
  {
    id: 'better-things',
    title: 'Better Things',
    sub: 'Single Album',
    cover: 'better-things.jpg',
    tracks: [
      { id: 'better-things-title', title: 'Better Things', sub: '[TITLE]' },
      { id: 'better-things-sped', title: 'Better Things (Sped Up Ver.)' },
      { id: 'better-things-slowed', title: 'Better Things (Slowed Down Ver.)' },
      { id: 'better-things-snack', title: 'Better Things (Snack Ver.)' }
    ]
  },

  // 7. Drama - The 4th Mini Album
  {
    id: 'drama',
    title: 'Drama - The 4th Mini Album',
    sub: 'EP',
    cover: 'drama.jpg',
    tracks: [
      { id: 'drama-title', title: 'Drama', sub: '[TITLE]' },
      { id: 'trick-or-trick', title: 'Trick or Trick' },
      { id: 'dont-blink', title: 'Don\'t Blink' },
      { id: 'hot-air-balloon', title: 'Hot Air Balloon' },
      { id: 'yolo', title: 'YOLO' },
      { id: 'you', title: 'You' },
      { id: 'drama-sped', title: 'Drama (Sped Up Ver.)' }
    ]
  },

  // 8. Jingle Bell Rock
  {
    id: 'jingle-bell-rock',
    title: 'Jingle Bell Rock',
    sub: 'Single Album',
    cover: 'jingle-bell-rock.jpg',
    tracks: [
      { id: 'jbr-title', title: 'Jingle Bell Rock', sub: '[TITLE]' },
      { id: 'jbr-sped', title: 'Jingle Bell Rock (Sped Up Ver.)' }
    ]
  },

  // 9. Armageddon - The 1st Album
  {
    id: 'armageddon',
    title: 'Armageddon - The 1st Album',
    sub: 'Full Album',
    cover: 'armageddon.jpg',
    tracks: [
      { id: 'supernova-title', title: 'Supernova', sub: '[TITLE]' },
      { id: 'armageddon-title', title: 'Armageddon', sub: '[TITLE]' },
      { id: 'set-the-tone', title: 'Set The Tone' },
      { id: 'mine', title: 'Mine' },
      { id: 'licorice', title: 'Licorice' },
      { id: 'bahama', title: 'BAHAMA' },
      { id: 'long-chat', title: 'Long Chat (#♥)' },
      { id: 'prologue', title: 'Prologue' },
      { id: 'live-my-life', title: 'Live My Life' },
      { id: 'melody', title: '목소리 (Melody)' }
    ]
  },

  // 10. Hot Mess
  {
    id: 'hot-mess',
    title: 'Hot Mess',
    sub: 'Single Album',
    cover: 'hot-mess.jpg',
    tracks: [
      { id: 'hot-mess-title', title: 'Hot Mess', sub: '[TITLE]' },
      { id: 'sun-and-moon', title: 'Sun and Moon' },
      { id: 'zoom-zoom', title: 'ZOOM ZOOM' }
    ]
  },

  // 11. SYNK : PARALLEL LINE
  {
    id: 'parallel-line',
    title: 'SYNK : PARALLEL LINE - Special Digital Single',
    sub: 'Single Album',
    cover: 'parallel-line.jpg',
    tracks: [
      { id: 'up-karina', title: 'UP (KARINA Solo)' },
      { id: 'dopamine-giselle', title: 'Dopamine (GISELLE Solo)' },
      { id: 'bored-ningning', title: 'Bored! (NINGNING Solo)' },
      { id: 'spark-winter', title: 'Spark (WINTER Solo)' }
    ]
  },

  // 12. Whiplash - The 5th Mini Album
  {
    id: 'whiplash',
    title: 'Whiplash - The 5th Mini Album',
    sub: 'EP',
    cover: 'whiplash.jpg',
    tracks: [
      { id: 'whiplash-title', title: 'Whiplash', sub: '[TITLE]' },
      { id: 'kill-it', title: 'Kill it' },
      { id: 'flights-not-feelings', title: 'Flights, Not Feelings' },
      { id: 'pink-hoodie', title: 'Pink Hoodie' },
      { id: 'flowers', title: 'Flowers' },
      { id: 'just-another-girl', title: 'Just Another Girl' }
    ]
  },

  // 13. Dirty Work
  {
    id: 'dirty-work',
    title: 'Dirty Work',
    sub: 'Single Album',
    cover: 'dirty-work.jpg',
    tracks: [
      { id: 'dirty-work-title', title: 'Dirty Work', sub: '[TITLE]' },
      { id: 'dirty-work-flo', title: 'Dirty Work (Feat. Flo Milli)' },
      { id: 'dirty-work-eng', title: 'Dirty Work (English Ver.)' }
    ]
  },

  // 14. Rich Man - The 6th Mini Album
  {
    id: 'rich-man',
    title: 'Rich Man - The 6th Mini Album',
    sub: 'EP',
    cover: 'rich-man.jpg',
    tracks: [
      { id: 'rich-man-title', title: 'Rich Man', sub: '[TITLE]' },
      { id: 'drift', title: 'Drift' },
      { id: 'bubble', title: 'Bubble' },
      { id: 'count-on-me', title: 'Count On Me' },
      { id: 'angel-48', title: 'Angel #48' },
      { id: 'to-the-girls', title: 'To The Girls' }
    ]
  },

  // 15. SYNK : aeXIS LINE
  {
    id: 'axis-line',
    title: 'SYNK : aeXIS LINE - 2025 Special Digital Single',
    sub: 'Single Album',
    cover: 'axis-line.jpg',
    tracks: [
      { id: 'blue-winter', title: 'BLUE (WINTER Solo)' },
      { id: 'ketchup-lemonade', title: 'Ketchup And Lemonade (NINGNING Solo)' },
      { id: 'tornado-giselle', title: 'Tornado (GISELLE Solo)' },
      { id: 'good-stuff-karina', title: 'GOOD STUFF (KARINA Solo)' }
    ]
  },

  // 16. OST / Collaboration (트랙별 다른 커버)
  {
    id: 'ost-collab',
    title: 'OST / Collaboration',
    sub: 'Special Releases',
    cover: 'ost-main.jpg',
    tracks: [
      { id: 'hold-on-tight', title: 'Hold On Tight', cover: 'hold-on-tight.jpg' },
      { id: 'we-go', title: 'We Go', cover: 'we-go.jpg' },
      { id: 'we-go-eng', title: 'We Go (Eng ver.)', cover: 'we-go-eng.jpg' },
      {
        id: 'sidae-yugam',
        title: '시대유감 (時代遺憾) (2024 aespa Remake Ver.)',
        cover: 'sidae-yugam.jpg'
      },
      { id: 'get-goin', title: 'Get Goin’', cover: 'get-goin.jpg' },
      { id: 'die-trying', title: 'Die Trying', cover: 'die-trying.jpg' },
      { id: 'rum-pum-pum', title: '첫 사랑니 (Rum Pum Pum Pum)', cover: 'rum-pum-pum.jpg' },
      { id: 'dark-arts', title: 'Dark Arts', cover: 'dark-arts.jpg' },
      { id: 'dollhouse-world', title: 'Dollhouse World', cover: 'dollhouse-world.jpg' }
    ]
  },

  // 17. Remix / Reworks 모음
  {
    id: 'remix-collection',
    title: 'Remix Albums',
    sub: 'Remix & Reworks',
    cover: 'remix-main.jpg',
    tracks: [
      // iScreaM Vol.10 : Next Level Remixes
      {
        id: 'next-level-habstrakt',
        title: 'Next Level (Habstrakt Remix)',
        sub: 'iScreaM Vol.10 : Next Level Remixes',
        cover: 'iscream-vol10.jpg'
      },
      {
        id: 'next-level-imlay',
        title: 'Next Level (IMLAY Remix)',
        sub: 'iScreaM Vol.10 : Next Level Remixes',
        cover: 'iscream-vol10.jpg'
      },
      {
        id: 'next-level-lionclad',
        title: 'Next Level (Lionclad Remix)',
        sub: 'iScreaM Vol.10 : Next Level Remixes',
        cover: 'iscream-vol10.jpg'
      },

      // iScreaM Vol.18 : Girls Remixes
      {
        id: 'girls-brllnt',
        title: 'Girls (BRLLNT Remix)',
        sub: 'iScreaM Vol.18 : Girls Remixes',
        cover: 'iscream-vol18.jpg'
      },
      {
        id: 'girls-minit',
        title: 'Girls (Minit Remix)',
        sub: 'iScreaM Vol.18 : Girls Remixes',
        cover: 'iscream-vol18.jpg'
      },

      // iScreaM Vol.26 : Spicy Remix
      {
        id: 'spicy-nitepunk',
        title: 'Spicy (Nitepunk Remix)',
        sub: 'iScreaM Vol.26 : Spicy Remix',
        cover: 'spicy-remix.jpg'
      },

      // Better Things Remix
      {
        id: 'better-things-tropkillaz',
        title: 'Better Things (Tropkillaz Remix)',
        sub: 'Better Things Remix',
        cover: 'better-things-remix.jpg'
      },
      {
        id: 'better-things-raye',
        title: 'Better Things (RAYE Remix)',
        sub: 'Better Things Remix',
        cover: 'better-things-remix.jpg'
      },
      {
        id: 'better-things-dance',
        title: 'Better Things (Dance Remix)',
        sub: 'Better Things Remix',
        cover: 'better-things-remix.jpg'
      },

      // iScreaM Vol.33 : Supernova / Armageddon Remixes
      {
        id: 'supernova-grimes',
        title: 'Supernova (Grimes Remix)',
        sub: 'iScreaM Vol.33 : Supernova / Armageddon Remixes',
        cover: 'iscream-vol33.jpg'
      },
      {
        id: 'armageddon-flava-d',
        title: 'Armageddon (Flava D Remix)',
        sub: 'iScreaM Vol.33 : Supernova / Armageddon Remixes',
        cover: 'iscream-vol33.jpg'
      },
      {
        id: 'armageddon-2spade-remix',
        title: 'Armageddon (2Spade Remix)',
        sub: 'iScreaM Vol.33 : Supernova / Armageddon Remixes',
        cover: 'iscream-vol33.jpg'
      },
      {
        id: 'armageddon-mount-xlr',
        title: 'Armageddon (Mount XLR Remix)',
        sub: 'iScreaM Vol.33 : Supernova / Armageddon Remixes',
        cover: 'iscream-vol33.jpg'
      },

      // RE:WORKS
      {
        id: 'supernova-reworks',
        title: 'Supernova (KENZIE RE:WORKS)',
        sub: 'RE:WORKS',
        cover: 'reworks.jpg'
      },

      // K-POP ScreaM 1
      {
        id: 'whiplash-monotostereo',
        title: 'Whiplash (monotostereo Remix)',
        sub: 'K-POP ScreaM 1',
        cover: 'kpop-scream-1.jpg'
      },
      {
        id: 'up-coziest',
        title: 'UP (KARINA Solo) (Coziest Remix)',
        sub: 'K-POP ScreaM 1',
        cover: 'kpop-scream-1.jpg'
      },
      {
        id: 'flights-demicat',
        title: 'Flights, Not Feelings (Demicat Remix)',
        sub: 'K-POP ScreaM 1',
        cover: 'kpop-scream-1.jpg'
      },
      {
        id: 'spark-2spade-remix',
        title: 'Spark (WINTER Solo) (2Spade Remix)',
        sub: 'K-POP ScreaM 1',
        cover: 'kpop-scream-1.jpg'
      },

      // Whiplash (English Ver.)
      {
        id: 'whiplash-eng',
        title: 'Whiplash (English Ver.)',
        sub: 'Whiplash (English Ver.)',
        cover: 'whiplash-eng-remix.jpg'
      },
      {
        id: 'whiplash-steve-aoki',
        title: 'Whiplash (Steve Aoki Remix)',
        sub: 'Whiplash (English Ver.)',
        cover: 'whiplash-eng-remix.jpg'
      },
      {
        id: 'whiplash-eng-sped',
        title: 'Whiplash (English Ver.) (Sped Up Ver.)',
        sub: 'Whiplash (English Ver.)',
        cover: 'whiplash-eng-remix.jpg'
      },

      // K-POP ScreaM 2
      {
        id: 'licorice-loozbone',
        title: 'Licorice (LOOZBONE Remix)',
        sub: 'K-POP ScreaM 2',
        cover: 'kpop-scream-2.jpg'
      },
      {
        id: 'armageddon-sixthema-epiik',
        title: 'Armageddon (SixThema & Epiik Remix)',
        sub: 'K-POP ScreaM 2',
        cover: 'kpop-scream-2.jpg'
      },
      {
        id: 'supernova-fahjah',
        title: 'Supernova (Fahjah Remix)',
        sub: 'K-POP ScreaM 2',
        cover: 'kpop-scream-2.jpg'
      },
      {
        id: 'whiplash-dj-long-nhat',
        title: 'Whiplash (DJ Long Nhat Remix)',
        sub: 'K-POP ScreaM 2',
        cover: 'kpop-scream-2.jpg'
      },

      // Dirty Work (Remixes)
      {
        id: 'dirty-work-rayray',
        title: 'Dirty Work (RayRay Remix)',
        sub: 'Dirty Work (Remixes)',
        cover: 'dirty-work-remix.jpg'
      },
      {
        id: 'dirty-work-arkins',
        title: 'Dirty Work (Arkins Remix)',
        sub: 'Dirty Work (Remixes)',
        cover: 'dirty-work-remix.jpg'
      },
      {
        id: 'dirty-work-2spade-remix',
        title: 'Dirty Work (2Spade Remix)',
        sub: 'Dirty Work (Remixes)',
        cover: 'dirty-work-remix.jpg'
      },

      // Rich Man (Remixes)
      {
        id: 'rich-man-sevdaliza',
        title: 'Rich Man (Feat. Sevdaliza)',
        sub: 'Rich Man (Remixes)',
        cover: 'rich-man-remix.jpg'
      },
      {
        id: 'rich-man-eng',
        title: 'Rich Man (English Ver.)',
        sub: 'Rich Man (Remixes)',
        cover: 'rich-man-remix.jpg'
      },
      {
        id: 'rich-man-yellow-claw',
        title: 'Rich Man (Yellow Claw Remix)',
        sub: 'Rich Man (Remixes)',
        cover: 'rich-man-remix.jpg'
      },
      {
        id: 'rich-man-dpr-cream-h4rdy',
        title: 'Rich Man (DPR CREAM & h4rdy Remix)',
        sub: 'Rich Man (Remixes)',
        cover: 'rich-man-remix.jpg'
      },
      {
        id: 'rich-man-dpr-artic',
        title: 'Rich Man (DPR ARTIC Remix)',
        sub: 'Rich Man (Remixes)',
        cover: 'rich-man-remix.jpg'
      }
    ]
  }
];

  const setlistBody = document.getElementById("setlistBody");

  const basePattern = [
    "ment",
    "song","song","song","song",
    "ment",
    "song","song","song","song",
    "ment",
    "song","song","song","song",
    "ment",
    "song","song","song","song",
    "ment",
    "song","song","song",
    "ment",
    "song","song","song","song",
    "ment",
    "song","song","song"
  ];

  let draggedMentRow = null;
  let currentSongCell = null;
  let currentPageIndex = 0;

  function updateOrderNumbers() {
    const rows = setlistBody.querySelectorAll("tr");
    let num = 1;
    rows.forEach(row => {
      const orderCell = row.querySelector(".order-cell");
      if (!orderCell) return;
      if (row.classList.contains("song-row")) {
        orderCell.textContent = num;
        num += 1;
      } else {
        orderCell.textContent = "";
      }
    });
  }

  function createSongRow(deletable = false) {
    const tr = document.createElement("tr");
    tr.classList.add("song-row");

    const tdOrder = document.createElement("td");
    tdOrder.className = "order-cell";

    const tdTitle = document.createElement("td");
    tdTitle.className = "song-title-cell";

    const wrapper = document.createElement("div");
    wrapper.className = "song-cell-wrapper";

    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "song-cell-btn empty";
    btn.textContent = "곡 선택";
    btn.addEventListener("click", () => openSongModal(btn));

    wrapper.appendChild(btn);

    if (deletable) {
      const delBtn = document.createElement("button");
      delBtn.type = "button";
      delBtn.className = "song-delete-btn";
      delBtn.textContent = "삭제";
      delBtn.addEventListener("click", () => {
        tr.remove();
        updateOrderNumbers();
      });
      wrapper.appendChild(delBtn);
    }

    tdTitle.appendChild(wrapper);
    tr.appendChild(tdOrder);
    tr.appendChild(tdTitle);
    setlistBody.appendChild(tr);
  }

  function getRowAfterY(y) {
    const rows = Array.from(setlistBody.querySelectorAll("tr")).filter(
      row => row !== draggedMentRow
    );
    let closest = null;
    for (const row of rows) {
      const box = row.getBoundingClientRect();
      const offset = y - (box.top + box.height / 2);
      if (offset < 0 && (!closest || offset > closest.offset)) {
        closest = { offset, row };
      }
    }
    return closest ? closest.row : null;
  }

  function attachMentRowDragEvents(row, handle) {
    if (!isTouch) {
      handle.setAttribute("draggable", "true");
      handle.addEventListener("dragstart", () => {
        draggedMentRow = row;
        row.classList.add("dragging");
      });
      handle.addEventListener("dragend", () => {
        if (draggedMentRow === row) draggedMentRow = null;
        row.classList.remove("dragging");
        updateOrderNumbers();
      });
    } else {
      let touchDragging = false;

      handle.addEventListener("touchstart", () => {
        touchDragging = true;
        draggedMentRow = row;
        row.classList.add("dragging");
      }, { passive: true });

      handle.addEventListener("touchend", () => {
        if (touchDragging) {
          touchDragging = false;
          if (draggedMentRow === row) draggedMentRow = null;
          row.classList.remove("dragging");
          updateOrderNumbers();
        }
      });

      handle.addEventListener("touchmove", (e) => {
        if (!touchDragging || !draggedMentRow) return;
        const touch = e.touches[0];
        const y = touch.clientY;
        const afterRow = getRowAfterY(y);
        if (!afterRow) {
          setlistBody.appendChild(draggedMentRow);
        } else {
          setlistBody.insertBefore(draggedMentRow, afterRow);
        }
        e.preventDefault();
      }, { passive: false });
    }
  }

  function createMentRow() {
    const tr = document.createElement("tr");
    tr.classList.add("ment-row");

    const tdOrder = document.createElement("td");
    tdOrder.className = "order-cell";

    const tdMain = document.createElement("td");
    tdMain.className = "ment-cell";

    const handle = document.createElement("span");
    handle.className = "ment-handle";
    handle.textContent = "≡";

    const label = document.createElement("span");
    label.className = "ment-label";
    label.textContent = "멘트 / VCR";

    const delBtn = document.createElement("button");
    delBtn.type = "button";
    delBtn.className = "ment-delete-btn";
    delBtn.textContent = "삭제";
    delBtn.addEventListener("click", () => {
      tr.remove();
      updateOrderNumbers();
    });

    tdMain.appendChild(handle);
    tdMain.appendChild(label);
    tdMain.appendChild(delBtn);

    tr.appendChild(tdOrder);
    tr.appendChild(tdMain);

    attachMentRowDragEvents(tr, handle);
    setlistBody.appendChild(tr);
  }

  function buildBaseTable() {
    basePattern.forEach(type => {
      if (type === "song") {
        createSongRow(false);
      } else {
        createMentRow();
      }
    });
    updateOrderNumbers();
  }

  setlistBody.addEventListener("dragover", (e) => {
    if (!draggedMentRow) return;
    e.preventDefault();
    const afterRow = getRowAfterY(e.clientY);
    if (!afterRow) setlistBody.appendChild(draggedMentRow);
    else setlistBody.insertBefore(draggedMentRow, afterRow);
  });

  const songModal = document.getElementById("songModal");
  const albumCoverEl = document.getElementById("albumCover");
  const albumTitleEl = document.getElementById("albumTitle");
  const albumSubEl = document.getElementById("albumSub");
  const trackListEl = document.getElementById("trackList");
  const pageIndicatorEl = document.getElementById("pageIndicator");
  const prevPageBtn = document.getElementById("prevPageBtn");
  const nextPageBtn = document.getElementById("nextPageBtn");

  function renderAlbumPage() {
    const page = albumPages[currentPageIndex];
    if (!page) return;

    albumCoverEl.src = page.cover || "";
    albumTitleEl.textContent = page.title || "";
    albumSubEl.textContent = page.sub || "";
    pageIndicatorEl.textContent = (currentPageIndex + 1) + " / " + albumPages.length;

    prevPageBtn.disabled = currentPageIndex === 0;
    nextPageBtn.disabled = currentPageIndex === albumPages.length - 1;

    trackListEl.innerHTML = "";
page.tracks.forEach(track => {
  const li = document.createElement("li");
  const btn = document.createElement("button");
  btn.type = "button";
  btn.className = "track-btn";

  const cover = document.createElement("img");
  cover.className = "track-cover";
  cover.src = track.cover || page.cover || "";
  cover.alt = "";

  const meta = document.createElement("div");
  meta.className = "track-meta";

  // 곡명 영역
  const main = document.createElement("div");
  main.className = "track-text-main";

  // TITLE 뱃지 여부 판단 (sub가 없으면 그냥 false)
  const hasTitleBadge = (track.sub || "").includes("[TITLE]");

  if (hasTitleBadge) {
    const badge = document.createElement("span");
    badge.textContent = "TITLE";
    badge.style.display = "inline-block";
    badge.style.fontSize = "10px";
    badge.style.fontWeight = "600";
    badge.style.padding = "2px 4px";
    badge.style.marginRight = "6px";
    badge.style.borderRadius = "4px";
    badge.style.background = "#e5e7eb";
    badge.style.color = "#444";
    main.appendChild(badge);
  }

  const titleText = document.createElement("span");
  titleText.textContent = track.title;
  main.appendChild(titleText);

 // 밑줄(앨범명) – TITLE 표시 처리
const sub = document.createElement("div");
sub.className = "track-text-sub";

// 1) 기본은 track.sub를 그대로 가져온다
let rawSub = track.sub;

// 2) sub가 없거나, 내용이 그냥 "[TITLE]" 하나뿐이면 → 앨범명으로 대체
if (!rawSub || rawSub.trim() === "[TITLE]") {
  rawSub = page.title || "";
}

// 3) 그래도 남아있을 수 있는 [TITLE] 문자열은 지워주고 정리
rawSub = rawSub.replace("[TITLE]", "").trim();

// 4) 최종 텍스트 반영
sub.textContent = rawSub;


  meta.appendChild(main);
  meta.appendChild(sub);

  btn.appendChild(cover);
  btn.appendChild(meta);

  btn.addEventListener("click", () => {
    if (currentSongCell) {
      currentSongCell.textContent = track.title;
      currentSongCell.classList.remove("empty");
    }
    closeSongModal();
  });

  li.appendChild(btn);
  trackListEl.appendChild(li);
});


    const liDirect = document.createElement("li");
    const directBtn = document.createElement("button");
    directBtn.type = "button";
    directBtn.className = "track-btn direct-input";
    directBtn.textContent = "[직접 입력]";
    directBtn.addEventListener("click", () => {
      const title = window.prompt("곡명을 직접 입력하세요.");
      if (title && currentSongCell) {
        currentSongCell.textContent = title;
        currentSongCell.classList.remove("empty");
      }
      closeSongModal();
    });
    liDirect.appendChild(directBtn);
    trackListEl.appendChild(liDirect);
  }

  function openSongModal(cellEl) {
    currentSongCell = cellEl;
    if (!albumPages.length) {
      alert("albumPages 데이터부터 채워야 곡 선택이 가능해.");
      return;
    }
    currentPageIndex = 0;
    renderAlbumPage();
    songModal.classList.add("open");
  }

  function closeSongModal() {
    songModal.classList.remove("open");
    currentSongCell = null;
  }

  document.getElementById("closeModalBtn").addEventListener("click", closeSongModal);
  songModal.addEventListener("click", (e) => {
    if (e.target === songModal) closeSongModal();
  });
  prevPageBtn.addEventListener("click", () => {
    if (currentPageIndex > 0) { currentPageIndex -= 1; renderAlbumPage(); }
  });
  nextPageBtn.addEventListener("click", () => {
    if (currentPageIndex < albumPages.length - 1) { currentPageIndex += 1; renderAlbumPage(); }
  });
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && songModal.classList.contains("open")) closeSongModal();
  });

  document.getElementById("addMentBtn").addEventListener("click", () => {
    createMentRow();
    updateOrderNumbers();
  });

  document.getElementById("addSongBtn").addEventListener("click", () => {
    createSongRow(true);
    updateOrderNumbers();
  });

 document.getElementById("exportBtn").addEventListener("click", () => {
  const posterEl = document.getElementById("poster");

  // 1) 캡쳐 전에 숨길 요소들 모으기
  const toHide = posterEl.querySelectorAll(
    ".ment-handle, .ment-delete-btn, .song-delete-btn"
  );

  // 기존 visibility 기억해두기
  const prevVisibilities = [];
  toHide.forEach(el => {
    prevVisibilities.push(el.style.visibility);
    el.style.visibility = "hidden";
  });

  // 2) 캡쳐
  html2canvas(posterEl, { scale: 2 }).then(canvas => {
    // 3) 저장
    const link = document.createElement("a");
    link.download = "setlist.png";
    link.href = canvas.toDataURL("image/png");
    link.click();

    // 4) 캡쳐 끝나면 다시 원래대로 복구
    toHide.forEach((el, idx) => {
      el.style.visibility = prevVisibilities[idx] || "";
    });
  });
});

  buildBaseTable();
</script>
</body>
</html>










